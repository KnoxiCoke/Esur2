<!-- HTML (CodePen) -->
<header class="topbar">
  <div class="topbar__title">ESUR CM Hypersensitivity Support</div>
  <button class="topbar__reset" id="resetBtn" type="button" aria-label="Reset">Reset</button>
</header>

<main class="app" id="app">
  <section class="banner" role="note" aria-label="Safety notice">
    <div class="banner__left">
      <div class="banner__headline">Educational tool (ESUR CMSC 2025)</div>
      <div class="banner__sub">No patient data stored. Does not replace clinical judgement or local protocols.</div>
    </div>
    <div class="banner__right"><span class="badge">Offline-ready</span></div>
  </section>

  <!-- QUICK FLOW -->
  <section class="view" id="view-flow" aria-labelledby="nav-flow">
    <h1 class="h1">Quick Flow</h1>
    <p class="p-muted">Reach an operational recommendation in ≤ 3 taps.</p>

    <div class="card">
      <div class="card__title">Step 1 — Situation</div>
      <div class="seg" role="tablist" aria-label="Situation">
        <button class="seg__btn is-on" type="button" data-seg="situation" data-value="elective" aria-pressed="true">Elective</button>
        <button class="seg__btn" type="button" data-seg="situation" data-value="emergency" aria-pressed="false">Emergency</button>
      </div>
    </div>

    <div class="card">
      <div class="card__title">Step 2 — Prior reaction</div>
      <div class="seg" role="tablist" aria-label="Prior reaction">
        <button class="seg__btn is-on" type="button" data-seg="severity" data-value="modsev" aria-pressed="true">Moderate / Severe</button>
        <button class="seg__btn" type="button" data-seg="severity" data-value="mild" aria-pressed="false">Mild / Unclear</button>
      </div>
    </div>

    <div class="card card--output" aria-live="polite">
      <div class="card__title">Recommendation</div>
      <div id="flowOutput" class="output"></div>
    </div>

    <div class="card card--subtle">
      <div class="card__title">Safety net</div>
      <div class="output">If a breakthrough reaction occurs → follow <strong>Poster 1 (Acute Management)</strong> and local emergency protocols.</div>
    </div>
  </section>

  <!-- SWITCH ASSISTANT -->
  <section class="view" id="view-switch" aria-labelledby="nav-switch" hidden>
    <h1 class="h1">Switch Assistant</h1>
    <p class="p-muted">Map culprit agent → structural group → alternative groups (educational).</p>

    <div class="card">
      <div class="card__title">Culprit contrast agent</div>

      <label class="field">
        <span class="field__label">Is the culprit agent known?</span>
        <div class="seg" role="tablist" aria-label="Culprit known">
          <button class="seg__btn is-on" type="button" data-seg="culpritKnown" data-value="known" aria-pressed="true">Known</button>
          <button class="seg__btn" type="button" data-seg="culpritKnown" data-value="unknown" aria-pressed="false">Unknown</button>
        </div>
      </label>

      <div id="agentSelectWrap" style="margin-top:12px">
        <label class="field">
          <span class="field__label">Select agent</span>
          <select id="agentSelect" class="field__control">
            <optgroup label="Iodinated contrast media (ICM)">
              <option value="iohexol">Iohexol (Group A)</option>
              <option value="iodixanol">Iodixanol (Group A)</option>
              <option value="iomeprol">Iomeprol (Group A)</option>
              <option value="ioversol">Ioversol (Group A)</option>
              <option value="iopamidol">Iopamidol (Group B)</option>
              <option value="iopromide">Iopromide (Group C)</option>
              <option value="iobitridol">Iobitridol (Group D)</option>
            </optgroup>
            <optgroup label="Gadolinium-based contrast agents (macrocyclic GBCA)">
              <option value="gadoterate">Gadoterate meglumine (Group A)</option>
              <option value="gadobutrol">Gadobutrol (Group B)</option>
              <option value="gadoteridol">Gadoteridol (Group B)</option>
              <option value="gadopiclenol">Gadopiclenol (Group C)</option>
            </optgroup>
          </select>
        </label>
      </div>
    </div>

    <div class="card card--output" aria-live="polite">
      <div class="card__title">Result</div>
      <div id="switchOutput" class="output"></div>
    </div>

    <div class="card card--subtle">
      <div class="card__title">Safety note</div>
      <div class="output">Cross-reactivity is <strong>high and variable</strong> → <strong>testing preferred when feasible</strong>. Always follow local protocols and specialist advice.</div>
    </div>
  </section>

  <!-- TRYPTASE -->
  <section class="view" id="view-tryptase" aria-labelledby="nav-tryptase" hidden>
    <h1 class="h1">Tryptase Check</h1>
    <p class="p-muted">Rule: acute ≥ 2 ng/mL + (1.2 × baseline) suggests IHR.</p>

    <div class="card">
      <div class="grid2">
        <label class="field">
          <span class="field__label">Baseline tryptase (ng/mL)</span>
          <input id="baselineInput" inputmode="decimal" class="field__control" placeholder="e.g., 5.0" />
        </label>
        <label class="field">
          <span class="field__label">Acute tryptase (ng/mL)</span>
          <input id="acuteInput" inputmode="decimal" class="field__control" placeholder="e.g., 12.0" />
        </label>
      </div>
      <button class="btn" id="calcBtn" type="button">Calculate</button>
    </div>

    <div class="card card--output" aria-live="polite">
      <div class="card__title">Interpretation</div>
      <div id="tryptaseOutput" class="output"></div>
    </div>

    <div class="card card--subtle">
      <div class="card__title">Sampling reminder</div>
      <div class="output">Acute sample: <strong>1–4 h</strong> after onset. Baseline: <strong>≥ 24 h</strong> after symptom resolution.</div>
    </div>
  </section>

  <!-- NIHR / SCAR -->
  <section class="view" id="view-nihr" aria-labelledby="nav-nihr" hidden>
    <h1 class="h1">NIHR / SCAR Red Flags</h1>
    <p class="p-muted">Late reactions: typically 1 hour to 1 week after administration.</p>

    <div class="card">
      <div class="card__title">Checklist</div>
      <div class="checklist" id="nihrChecklist">
        <label class="check"><input type="checkbox" data-flag="Blistering" /> Blistering</label>
        <label class="check"><input type="checkbox" data-flag="Erosions / hemorrhagic lesions" /> Erosions / hemorrhagic lesions</label>
        <label class="check"><input type="checkbox" data-flag="Mucosal involvement" /> Mucosal involvement</label>
        <label class="check"><input type="checkbox" data-flag="Systemic symptoms (e.g., high fever)" /> Systemic symptoms (e.g., high fever)</label>
      </div>
    </div>

    <div class="card card--output" aria-live="polite">
      <div class="card__title">Guidance</div>
      <div id="nihrOutput" class="output"></div>
    </div>

    <div class="card card--subtle">
      <div class="card__title">Action</div>
      <div class="output">Avoid the culprit agent/class; prompt specialist referral. Premedication is not recommended for NIHR.</div>
    </div>
  </section>

  <footer class="footer">
    <div class="footer__text">Educational summary based on ESUR CMSC Guidance (2025). Not an official guideline.</div>
  </footer>
</main>

<nav class="bottomnav" aria-label="Primary">
  <button class="bottomnav__btn is-active" id="nav-flow" data-nav="flow" type="button"><span class="bottomnav__icon" aria-hidden="true">⇄</span><span class="bottomnav__label">Flow</span></button>
  <button class="bottomnav__btn" id="nav-switch" data-nav="switch" type="button"><span class="bottomnav__icon" aria-hidden="true">⚗</span><span class="bottomnav__label">Switch</span></button>
  <button class="bottomnav__btn" id="nav-tryptase" data-nav="tryptase" type="button"><span class="bottomnav__icon" aria-hidden="true">∑</span><span class="bottomnav__label">Tryptase</span></button>
  <button class="bottomnav__btn" id="nav-nihr" data-nav="nihr" type="button"><span class="bottomnav__icon" aria-hidden="true">⚠</span><span class="bottomnav__label">NIHR</span></button>
</nav>
